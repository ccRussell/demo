## Jstorm安装

### 下载(2.2.1版本)

```shell
wget https://github.com/alibaba/jstorm/releases/download/2.2.1/jstorm-2.2.1.zip

## github(安装包+源码)
https://github.com/alibaba/jstorm/releases
```

### 安装Python

### 安装zk

### 安装JDK(1.7版本及以上)

### 配置

```shell
## 解压缩
unzip jstorm-2.2.1.zip

## 设置环境变量
vim .zshrc
export JSTORM_HOME=/Users/liumenghao/bigData/jstorm-2.2.1
export PATH=$JSTORM_HOME/bin:$PATH

## 使其生效
source .zshrc

## 配置storm.yaml
cd $JSTORM_HOME/conf/
vim storm.yaml
```

修改配置文件是有讲究的，顶头开头或者以空格开头不可以随便设置：

```shell
########### These MUST be filled in for a storm configuration
 storm.zookeeper.servers:
     - "localhost"

 storm.zookeeper.root: "/jstorm"

# cluster.name: "default"

 #nimbus.host/nimbus.host.start.supervisor is being used by $JSTORM_HOME/bin/start.sh
 #it only support IP, please don't set hostname
 # For example
 # nimbus.host: "10.132.168.10, 10.132.168.45"
 nimbus.host: "localhost"
 #nimbus.host.start.supervisor: false

# %JSTORM_HOME% is the jstorm home directory
 storm.local.dir: "/Users/liumenghao/bigData/jstorm-2.2.1/data"
 # please set absolute path, default path is JSTORM_HOME/logs
# jstorm.log.dir: "absolute path"

# java.library.path: "/usr/local/lib:/opt/local/lib:/usr/lib"



# if supervisor.slots.ports is null,
# the port list will be generated by cpu cores and system memory size
# for example,
# there are cpu_num = system_physical_cpu_num/supervisor.slots.port.cpu.weight
# there are mem_num = system_physical_memory_size/(worker.memory.size * supervisor.slots.port.mem.weight)
# The final port number is min(cpu_num, mem_num)
 supervisor.slots.ports.base: 6800
 supervisor.slots.port.cpu.weight: 1.2
# supervisor.slots.port.mem.weight: 0.7
# supervisor.slots.ports: null
 supervisor.slots.ports:
    - 6800
    - 6801
    - 6802
    - 6803

# Default disable user-define classloader
# If there are jar conflict between jstorm and application,
# please enable it
# topology.enable.classloader: false

# enable supervisor use cgroup to make resource isolation
# Before enable it, you should make sure:
#       1. Linux version (>= 2.6.18)
#       2. Have installed cgroup (check the file's existence:/proc/cgroups)
#       3. You should start your supervisor on root
# You can get more about cgroup:
#   http://t.cn/8s7nexU
# supervisor.enable.cgroup: false

### Netty will send multiple messages in one batch
### Setting true will improve throughput, but more latency
# storm.messaging.netty.transfer.async.batch: true

### default worker memory size, unit is byte
# worker.memory.size: 2147483648

# Metrics Monitor
# topology.performance.metrics: it is the switch flag for performance
# purpose. When it is disabled, the data of timer and histogram metrics
# will not be collected.
# topology.alimonitor.metrics.post: If it is disable, metrics data
# will only be printed to log. If it is enabled, the metrics data will be
# posted to alimonitor besides printing to log.
# topology.performance.metrics: true
# topology.alimonitor.metrics.post: false

# UI MultiCluster
# Following is an example of multicluster UI configuration
# ui.clusters:
#     - {
#         name: "jstorm",
#         zkRoot: "/jstorm",
#         zkServers:
#             [ "localhost"],
#         zkPort: 2181,
#       }
```

### 启动Jstorm

```shell
## 启动nimbus
nohup jstorm nimbus &

## 启动supervisor
nohup jstorm supervisor &

## 检查是否启动成功
jps
1813 NimbusServer  ## nimbus
11495 QuorumPeerMain  ## zk
1883 Supervisor ## supervisor
```

### 安装webUI

```shell
## 重要（这步必须要做，否则启动UI会报错）
mkdir ~/.jstorm
cp -f $JSTORM_HOME/conf/storm.yaml ~/.jstorm

## 安装tomcat7.0版本以上,进入到webapp目录
cd apache-tomcat-8.5.37/webapps

## 将jstorm中的war包拷贝过来
cp $JSTORM_HOME/jstorm-ui-2.2.1.war ./

## 将tomcat中原本的ROOT文件备份
mv ROOT ROOT.old

## 将ROOT文件夹和jstorm-ui-2.2.1文件夹建立软连接
ln -s jstorm-ui-2.2.1 ROOT

## 进入到tomact bin目录，启动
cd $TOMCAT_HOME/bin
./startup.sh

## 访问localhost:8080
```

### 启动ZK UI

```shell
## 安装ZK UI（其实就是一个jar包）
## 后台启动ZK UI
nohup java -jar zk-web-0.1.0-SNAPSHOT-standalone.jar &

## 访问ui
locahost:8086
```

